<?php

namespace Main\Bundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * ItemRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ItemRepository extends EntityRepository
{

    /**
     * @param array $vars
     * @return array
     */
    public function findOthersItems(array $vars)
    {
        $em = $this->getEntityManager();

        $query = $em->createQueryBuilder()
            ->select('it')
            ->from('MainBundle:Item', 'it')

            ->where('it.chain = :chain')
            ->andWhere('it.id <> :id')

            ->setParameter('chain', $vars['chain'])
            ->setParameter('id', $vars['id'])

            ->orderBy('it.id','DESC')

            ->setMaxResults($vars['limit'])
        ;

        return $query->getQuery()->getResult();
    }


    public function getListItems($city_id, $lang)
    {
        $em = $this->getEntityManager();

        $query = $em->createQueryBuilder()
            ->select('it', 'ch')
            ->from('MainBundle:Item', 'it')

            ->join('it.chain','ch')

            ->where('ch.city_id = :city_id')
            ->andWhere('ch.lang = :lang')

            ->setParameter('city_id', $city_id)
            ->setParameter('lang', $lang)

            ->orderBy('it.id','DESC')
        ;

        return $query->getQuery()->getResult();
    }

}
